Job running on landonia05
Job started: 13/01/2024 14:59:46
Setting up bash environment
Activating conda environment: masters
Running provided command: python finetuning.py --configfile=./configs/AEconfigs/16_layer.all_cluster.yml
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[15:00:56] SMILES Parse Error: syntax error while parsing: OC1=CC=CC(=C1)C-1=C2\CCC(=N2)\C(=C2/N\C(\C=C2)=C(/C2=N/C(/C=C2)=C(\C2=CC=C\-1N2)C1=CC(O)=CC=C1)C1=CC(O)=CC=C1)\C1=CC(O)=CC=C1
[15:00:56] SMILES Parse Error: Failed parsing SMILES 'OC1=CC=CC(=C1)C-1=C2\CCC(=N2)\C(=C2/N\C(\C=C2)=C(/C2=N/C(/C=C2)=C(\C2=CC=C\-1N2)C1=CC(O)=CC=C1)C1=CC(O)=CC=C1)\C1=CC(O)=CC=C1' for input: 'OC1=CC=CC(=C1)C-1=C2\CCC(=N2)\C(=C2/N\C(\C=C2)=C(/C2=N/C(/C=C2)=C(\C2=CC=C\-1N2)C1=CC(O)=CC=C1)C1=CC(O)=CC=C1)\C1=CC(O)=CC=C1'
[15:00:56] Explicit valence for atom # 0 N, 4, is greater than permitted
[15:00:56] Explicit valence for atom # 0 N, 4, is greater than permitted
[15:00:56] Explicit valence for atom # 0 N, 4, is greater than permitted
[15:00:56] Explicit valence for atom # 0 N, 4, is greater than permitted
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]

  | Name  | Type     | Params
-----------------------------------
0 | model | DeepDrug | 2.5 M 
-----------------------------------
2.5 M     Trainable params
0         Non-trainable params
2.5 M     Total params
10.176    Total estimated model params size (MB)
Metric val_epoch_F1 improved. New best score: 0.641
Metric val_epoch_F1 improved by 0.024 >= min_delta = 0.001. New best score: 0.665
Metric val_epoch_F1 improved by 0.010 >= min_delta = 0.001. New best score: 0.674
Metric val_epoch_F1 improved by 0.003 >= min_delta = 0.001. New best score: 0.677
Monitored metric val_epoch_F1 did not improve in the last 10 records. Best score: 0.677. Signaling Trainer to stop.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Namespace(configfile='./configs/AEconfigs/16_layer.all_cluster.yml')
{'dataset': 'DrugBank', 'task': 'binary', 'category': 'DDI', 'entry1_file': './dataset/DrugBank/drug/processed/data.pt', 'entry2_file': './dataset/DrugBank/drug/processed/data.pt', 'entry1_seq_file': './dataset/DrugBank/drug/drug.csv', 'entry2_seq_file': './dataset/DrugBank/drug/drug.csv', 'pair_file': './dataset/DrugBank/binary_1vs1/entry_pairs.csv', 'label_file': './dataset/DrugBank/binary_1vs1/pair_labels.csv', 'save_folder': './output/DrugBank/binary_1vs1/all_cluster/', 'split_strategy': 'sample_from_all_clusters', 'gconv_ckpt': './model_checkpoints/epoch_100_layers_16_all_cls/last.ckpt', 'cnn_ckpt': './model_checkpoints/cnn_max_epoch_80_all_cls/last.ckpt', 'lin_eval': False, 'model_type': 'deepdrug', 'gpus': 0, 'num_out_dim': 1, 'n_layers': 16}
print parameters:
{
  "earlystopping_tracking": "val_epoch_F1",
  "entry1_data_folder": "./dataset/DrugBank/drug",
  "entry1_seq_file": "./dataset/DrugBank/drug/drug.csv",
  "entry2_data_folder": "./dataset/DrugBank/drug",
  "entry2_seq_file": "./dataset/DrugBank/drug/drug.csv",
  "entry_pairs_file": "./dataset/DrugBank/binary_1vs1/entry_pairs.csv",
  "gpus": 0,
  "model_type": "deepdrug",
  "pair_labels_file": "./dataset/DrugBank/binary_1vs1/pair_labels.csv",
  "save_folder": "./output/DrugBank/binary_1vs1/all_cluster/",
  "scheduler_ReduceLROnPlateau_tracking": "F1",
  "split_strat": "sample_from_all_clusters",
  "task_type": "binary",
  "y_pred_file": "./output/DrugBank/binary_1vs1/all_cluster/test_pred.csv",
  "y_transfrom_func": null,
  "y_true_file": "./output/DrugBank/binary_1vs1/all_cluster/test_true.csv"
}
DeepDrug(
  (gconv1): DeeperGCN(
    (node_encoder): Sequential(
      (0): Linear(in_features=121, out_features=128, bias=True)
      (1): LayerNorm((128,), eps=1e-05, elementwise_affine=True)
    )
    (gcn_blocks): ModuleList(
      (0): ModuleList(
        (0): DeepGCNLayerV2(block=res+)
        (1): DeepGCNLayerV2(block=res+)
        (2): DeepGCNLayerV2(block=res+)
        (3): DeepGCNLayerV2(block=res+)
        (4): DeepGCNLayerV2(block=res+)
        (5): DeepGCNLayerV2(block=res+)
        (6): DeepGCNLayerV2(block=res+)
        (7): DeepGCNLayerV2(block=res+)
        (8): DeepGCNLayerV2(block=res+)
        (9): DeepGCNLayerV2(block=res+)
        (10): DeepGCNLayerV2(block=res+)
        (11): DeepGCNLayerV2(block=res+)
        (12): DeepGCNLayerV2(block=res+)
        (13): DeepGCNLayerV2(block=res+)
        (14): DeepGCNLayerV2(block=res+)
        (15): DeepGCNLayerV2(block=res+)
      )
    )
    (edge_encoder): Sequential(
      (0): Linear(in_features=11, out_features=128, bias=True)
      (1): LayerNorm((128,), eps=1e-05, elementwise_affine=True)
    )
  )
  (gconv1_seq): CNN(
    (conv): ModuleList(
      (0): Conv1d(67, 32, kernel_size=(4,), stride=(1,))
      (1): Conv1d(32, 64, kernel_size=(6,), stride=(1,))
      (2): Conv1d(64, 96, kernel_size=(8,), stride=(1,))
    )
    (fc1): Linear(in_features=96, out_features=128, bias=True)
  )
  (gconv2): DeeperGCN(
    (node_encoder): Sequential(
      (0): Linear(in_features=121, out_features=128, bias=True)
      (1): LayerNorm((128,), eps=1e-05, elementwise_affine=True)
    )
    (gcn_blocks): ModuleList(
      (0): ModuleList(
        (0): DeepGCNLayerV2(block=res+)
        (1): DeepGCNLayerV2(block=res+)
        (2): DeepGCNLayerV2(block=res+)
        (3): DeepGCNLayerV2(block=res+)
        (4): DeepGCNLayerV2(block=res+)
        (5): DeepGCNLayerV2(block=res+)
        (6): DeepGCNLayerV2(block=res+)
        (7): DeepGCNLayerV2(block=res+)
        (8): DeepGCNLayerV2(block=res+)
        (9): DeepGCNLayerV2(block=res+)
        (10): DeepGCNLayerV2(block=res+)
        (11): DeepGCNLayerV2(block=res+)
        (12): DeepGCNLayerV2(block=res+)
        (13): DeepGCNLayerV2(block=res+)
        (14): DeepGCNLayerV2(block=res+)
        (15): DeepGCNLayerV2(block=res+)
      )
    )
    (edge_encoder): Sequential(
      (0): Linear(in_features=11, out_features=128, bias=True)
      (1): LayerNorm((128,), eps=1e-05, elementwise_affine=True)
    )
  )
  (gconv2_seq): CNN(
    (conv): ModuleList(
      (0): Conv1d(67, 32, kernel_size=(4,), stride=(1,))
      (1): Conv1d(32, 64, kernel_size=(6,), stride=(1,))
      (2): Conv1d(64, 96, kernel_size=(8,), stride=(1,))
    )
    (fc1): Linear(in_features=96, out_features=128, bias=True)
  )
  (global_fc_nn): Sequential(
    (0): Linear(in_features=512, out_features=128, bias=True)
    (1): BatchNorm1d(128, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
    (2): Dropout(p=0.2, inplace=False)
    (3): ReLU()
    (4): Linear(in_features=128, out_features=32, bias=True)
    (5): BatchNorm1d(32, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
    (6): Dropout(p=0.2, inplace=False)
    (7): ReLU()
  )
  (fc2): Linear(in_features=32, out_features=1, bias=True)
)
PreModel(
  (encoder): DeeperGCN(
    (node_encoder): Sequential(
      (0): Linear(in_features=121, out_features=128, bias=True)
      (1): LayerNorm((128,), eps=1e-05, elementwise_affine=True)
    )
    (gcn_blocks): ModuleList(
      (0): ModuleList(
        (0): DeepGCNLayerV2(block=res+)
        (1): DeepGCNLayerV2(block=res+)
        (2): DeepGCNLayerV2(block=res+)
        (3): DeepGCNLayerV2(block=res+)
        (4): DeepGCNLayerV2(block=res+)
        (5): DeepGCNLayerV2(block=res+)
        (6): DeepGCNLayerV2(block=res+)
        (7): DeepGCNLayerV2(block=res+)
        (8): DeepGCNLayerV2(block=res+)
        (9): DeepGCNLayerV2(block=res+)
        (10): DeepGCNLayerV2(block=res+)
        (11): DeepGCNLayerV2(block=res+)
        (12): DeepGCNLayerV2(block=res+)
        (13): DeepGCNLayerV2(block=res+)
        (14): DeepGCNLayerV2(block=res+)
        (15): DeepGCNLayerV2(block=res+)
      )
    )
    (edge_encoder): Sequential(
      (0): Linear(in_features=11, out_features=128, bias=True)
      (1): LayerNorm((128,), eps=1e-05, elementwise_affine=True)
    )
  )
  (decoder): DeeperGCN(
    (node_encoder): Sequential(
      (0): Linear(in_features=128, out_features=121, bias=True)
      (1): LayerNorm((121,), eps=1e-05, elementwise_affine=True)
    )
    (gcn_blocks): ModuleList(
      (0): ModuleList(
        (0): DeepGCNLayerV2(block=res+)
      )
    )
    (edge_encoder): Sequential(
      (0): Linear(in_features=128, out_features=11, bias=True)
      (1): LayerNorm((11,), eps=1e-05, elementwise_affine=True)
    )
    (edge_decoder): Linear(in_features=121, out_features=11, bias=True)
  )
  (encoder2decoder_nodes): Linear(in_features=128, out_features=128, bias=False)
  (encoder2decoder_edges): Linear(in_features=128, out_features=128, bias=False)
)
PreModel(
  (encoder): DeeperGCN(
    (node_encoder): Sequential(
      (0): Linear(in_features=121, out_features=128, bias=True)
      (1): LayerNorm((128,), eps=1e-05, elementwise_affine=True)
    )
    (gcn_blocks): ModuleList(
      (0): ModuleList(
        (0): DeepGCNLayerV2(block=res+)
        (1): DeepGCNLayerV2(block=res+)
        (2): DeepGCNLayerV2(block=res+)
        (3): DeepGCNLayerV2(block=res+)
        (4): DeepGCNLayerV2(block=res+)
        (5): DeepGCNLayerV2(block=res+)
        (6): DeepGCNLayerV2(block=res+)
        (7): DeepGCNLayerV2(block=res+)
        (8): DeepGCNLayerV2(block=res+)
        (9): DeepGCNLayerV2(block=res+)
        (10): DeepGCNLayerV2(block=res+)
        (11): DeepGCNLayerV2(block=res+)
        (12): DeepGCNLayerV2(block=res+)
        (13): DeepGCNLayerV2(block=res+)
        (14): DeepGCNLayerV2(block=res+)
        (15): DeepGCNLayerV2(block=res+)
      )
    )
    (edge_encoder): Sequential(
      (0): Linear(in_features=11, out_features=128, bias=True)
      (1): LayerNorm((128,), eps=1e-05, elementwise_affine=True)
    )
  )
  (decoder): DeeperGCN(
    (node_encoder): Sequential(
      (0): Linear(in_features=128, out_features=121, bias=True)
      (1): LayerNorm((121,), eps=1e-05, elementwise_affine=True)
    )
    (gcn_blocks): ModuleList(
      (0): ModuleList(
        (0): DeepGCNLayerV2(block=res+)
      )
    )
    (edge_encoder): Sequential(
      (0): Linear(in_features=128, out_features=11, bias=True)
      (1): LayerNorm((11,), eps=1e-05, elementwise_affine=True)
    )
    (edge_decoder): Linear(in_features=121, out_features=11, bias=True)
  )
  (encoder2decoder_nodes): Linear(in_features=128, out_features=128, bias=False)
  (encoder2decoder_edges): Linear(in_features=128, out_features=128, bias=False)
)
SMILESEnc2Dec(
  (encoder): CNN(
    (conv): ModuleList(
      (0): Conv1d(67, 32, kernel_size=(4,), stride=(1,))
      (1): Conv1d(32, 64, kernel_size=(6,), stride=(1,))
      (2): Conv1d(64, 96, kernel_size=(8,), stride=(1,))
    )
  )
  (decoder): CNN(
    (conv): ModuleList(
      (0): Conv1d(96, 96, kernel_size=(8,), stride=(1,))
      (1): Conv1d(96, 64, kernel_size=(6,), stride=(1,))
      (2): Conv1d(64, 67, kernel_size=(4,), stride=(1,))
    )
  )
  (decoder_pred): Linear(in_features=170, out_features=200, bias=True)
)
SMILESEnc2Dec(
  (encoder): CNN(
    (conv): ModuleList(
      (0): Conv1d(67, 32, kernel_size=(4,), stride=(1,))
      (1): Conv1d(32, 64, kernel_size=(6,), stride=(1,))
      (2): Conv1d(64, 96, kernel_size=(8,), stride=(1,))
    )
  )
  (decoder): CNN(
    (conv): ModuleList(
      (0): Conv1d(96, 96, kernel_size=(8,), stride=(1,))
      (1): Conv1d(96, 64, kernel_size=(6,), stride=(1,))
      (2): Conv1d(64, 67, kernel_size=(4,), stride=(1,))
    )
  )
  (decoder_pred): Linear(in_features=170, out_features=200, bias=True)
)
preparing dataset...
loading processed data...
add degrees as node features for each sample...
using drug sequences file: ./dataset/DrugBank/drug
print save parquet file to load quickly next time at ./dataset/DrugBank/drug/drug.parquet
                                        SMILES                                              entry
drugID                                                                                           
DB04571    CC1=CC2=CC3=C(OC(=O)C=C3C)C(C)=C2O1  [21, 21, 25, 48, 21, 21, 10, 48, 21, 21, 26, 4...
DB00855                        NCC(=O)CCC(O)=O  [30, 21, 21, 55, 48, 64, 24, 21, 21, 21, 55, 6...
DB09536                               O=[Ti]=O  [64, 48, 12, 47, 33, 51, 48, 64, 29, 29, 29, 2...
DB01600  CC(C(O)=O)C1=CC=C(S1)C(=O)C1=CC=CC=C1  [21, 21, 55, 21, 55, 64, 24, 48, 64, 24, 21, 2...
checking entryIDs finished for MultiEmbedDataset_v1.
loading processed data...
add degrees as node features for each sample...
using target sequences file: ./dataset/DrugBank/drug
print save parquet file to load quickly next time at ./dataset/DrugBank/drug/drug.parquet
                                        SMILES                                              entry
drugID                                                                                           
DB04571    CC1=CC2=CC3=C(OC(=O)C=C3C)C(C)=C2O1  [21, 21, 25, 48, 21, 21, 10, 48, 21, 21, 26, 4...
DB00855                        NCC(=O)CCC(O)=O  [30, 21, 21, 55, 48, 64, 24, 21, 21, 21, 55, 6...
DB09536                               O=[Ti]=O  [64, 48, 12, 47, 33, 51, 48, 64, 29, 29, 29, 2...
DB01600  CC(C(O)=O)C1=CC=C(S1)C(=O)C1=CC=CC=C1  [21, 21, 55, 21, 55, 64, 24, 48, 64, 24, 21, 2...
checking entryIDs finished for MultiEmbedDataset_v1.
can not find cv_file,  sample_from_all_clusters ...
0.6432526276276276
0.13022136720053387
0.22652600517183852
in val dataloader...

val:Ep0000|| F1: 0.000,auROC nan,auPRC: 1.000
in train dataloader...

val:Ep0000|| F1: 0.641,auROC 0.752,auPRC: 0.760

trn:Ep0000|| F1: 0.780,auROC 0.853,auPRC: 0.835

val:Ep0001|| F1: 0.665,auROC 0.758,auPRC: 0.774

trn:Ep0001|| F1: 0.842,auROC 0.913,auPRC: 0.896

val:Ep0002|| F1: 0.674,auROC 0.775,auPRC: 0.782

trn:Ep0002|| F1: 0.863,auROC 0.932,auPRC: 0.920

val:Ep0003|| F1: 0.587,auROC 0.757,auPRC: 0.772

trn:Ep0003|| F1: 0.876,auROC 0.943,auPRC: 0.933

val:Ep0004|| F1: 0.677,auROC 0.766,auPRC: 0.776

trn:Ep0004|| F1: 0.886,auROC 0.950,auPRC: 0.942

val:Ep0005|| F1: 0.648,auROC 0.770,auPRC: 0.783

trn:Ep0005|| F1: 0.893,auROC 0.956,auPRC: 0.949

val:Ep0006|| F1: 0.635,auROC 0.772,auPRC: 0.789

trn:Ep0006|| F1: 0.898,auROC 0.959,auPRC: 0.953

val:Ep0007|| F1: 0.600,auROC 0.764,auPRC: 0.785

trn:Ep0007|| F1: 0.903,auROC 0.962,auPRC: 0.956

val:Ep0008|| F1: 0.612,auROC 0.764,auPRC: 0.781

trn:Ep0008|| F1: 0.907,auROC 0.965,auPRC: 0.959

val:Ep0009|| F1: 0.609,auROC 0.766,auPRC: 0.785

trn:Ep0009|| F1: 0.910,auROC 0.967,auPRC: 0.962

val:Ep0010|| F1: 0.624,auROC 0.772,auPRC: 0.790

trn:Ep0010|| F1: 0.914,auROC 0.969,auPRC: 0.964

val:Ep0011|| F1: 0.617,auROC 0.772,auPRC: 0.789

trn:Ep0011|| F1: 0.916,auROC 0.970,auPRC: 0.966

val:Ep0012|| F1: 0.596,auROC 0.764,auPRC: 0.781

trn:Ep0012|| F1: 0.918,auROC 0.972,auPRC: 0.968

val:Ep0013|| F1: 0.677,auROC 0.783,auPRC: 0.797
Epoch 00015: reducing learning rate of group 0 to 1.0000e-04.

trn:Ep0013|| F1: 0.921,auROC 0.973,auPRC: 0.969

val:Ep0014|| F1: 0.617,auROC 0.776,auPRC: 0.795
loading best weight in /home/s1950841/MAEDDI/output/DrugBank/binary_1vs1/all_cluster/models/epoch=4-step=4820.ckpt ...
DeepDrug(
  (gconv1): DeeperGCN(
    (node_encoder): Sequential(
      (0): Linear(in_features=121, out_features=128, bias=True)
      (1): LayerNorm((128,), eps=1e-05, elementwise_affine=True)
    )
    (gcn_blocks): ModuleList(
      (0): ModuleList(
        (0): DeepGCNLayerV2(block=res+)
        (1): DeepGCNLayerV2(block=res+)
        (2): DeepGCNLayerV2(block=res+)
        (3): DeepGCNLayerV2(block=res+)
        (4): DeepGCNLayerV2(block=res+)
        (5): DeepGCNLayerV2(block=res+)
        (6): DeepGCNLayerV2(block=res+)
        (7): DeepGCNLayerV2(block=res+)
        (8): DeepGCNLayerV2(block=res+)
        (9): DeepGCNLayerV2(block=res+)
        (10): DeepGCNLayerV2(block=res+)
        (11): DeepGCNLayerV2(block=res+)
        (12): DeepGCNLayerV2(block=res+)
        (13): DeepGCNLayerV2(block=res+)
        (14): DeepGCNLayerV2(block=res+)
        (15): DeepGCNLayerV2(block=res+)
      )
    )
    (edge_encoder): Sequential(
      (0): Linear(in_features=11, out_features=128, bias=True)
      (1): LayerNorm((128,), eps=1e-05, elementwise_affine=True)
    )
  )
  (gconv1_seq): CNN(
    (conv): ModuleList(
      (0): Conv1d(67, 32, kernel_size=(4,), stride=(1,))
      (1): Conv1d(32, 64, kernel_size=(6,), stride=(1,))
      (2): Conv1d(64, 96, kernel_size=(8,), stride=(1,))
    )
    (fc1): Linear(in_features=96, out_features=128, bias=True)
  )
  (gconv2): DeeperGCN(
    (node_encoder): Sequential(
      (0): Linear(in_features=121, out_features=128, bias=True)
      (1): LayerNorm((128,), eps=1e-05, elementwise_affine=True)
    )
    (gcn_blocks): ModuleList(
      (0): ModuleList(
        (0): DeepGCNLayerV2(block=res+)
        (1): DeepGCNLayerV2(block=res+)
        (2): DeepGCNLayerV2(block=res+)
        (3): DeepGCNLayerV2(block=res+)
        (4): DeepGCNLayerV2(block=res+)
        (5): DeepGCNLayerV2(block=res+)
        (6): DeepGCNLayerV2(block=res+)
        (7): DeepGCNLayerV2(block=res+)
        (8): DeepGCNLayerV2(block=res+)
        (9): DeepGCNLayerV2(block=res+)
        (10): DeepGCNLayerV2(block=res+)
        (11): DeepGCNLayerV2(block=res+)
        (12): DeepGCNLayerV2(block=res+)
        (13): DeepGCNLayerV2(block=res+)
        (14): DeepGCNLayerV2(block=res+)
        (15): DeepGCNLayerV2(block=res+)
      )
    )
    (edge_encoder): Sequential(
      (0): Linear(in_features=11, out_features=128, bias=True)
      (1): LayerNorm((128,), eps=1e-05, elementwise_affine=True)
    )
  )
  (gconv2_seq): CNN(
    (conv): ModuleList(
      (0): Conv1d(67, 32, kernel_size=(4,), stride=(1,))
      (1): Conv1d(32, 64, kernel_size=(6,), stride=(1,))
      (2): Conv1d(64, 96, kernel_size=(8,), stride=(1,))
    )
    (fc1): Linear(in_features=96, out_features=128, bias=True)
  )
  (global_fc_nn): Sequential(
    (0): Linear(in_features=512, out_features=128, bias=True)
    (1): BatchNorm1d(128, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
    (2): Dropout(p=0.2, inplace=False)
    (3): ReLU()
    (4): Linear(in_features=128, out_features=32, bias=True)
    (5): BatchNorm1d(32, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
    (6): Dropout(p=0.2, inplace=False)
    (7): ReLU()
  )
  (fc2): Linear(in_features=32, out_features=1, bias=True)
)
in test dataloader...

tst:Ep0015|| F1: 0.702,auROC 0.786,auPRC: 0.785
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
       Test metric             DataLoader 0
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
        test_loss           0.6794857978820801
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
in test dataloader...
save prediction completed.
Command ran successfully!

============
job finished successfully
Job finished: 13/01/2024 17:50:01
